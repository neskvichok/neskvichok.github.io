(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{5946:function(e,t,r){Promise.resolve().then(r.bind(r,7513))},7513:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return v}});var n=r(7437),s=r(2265);function i(e){let{children:t}=e;return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsx)("div",{className:"py-6 md:py-8",children:t})})}function a(e){let{modes:t,value:r,onChange:s}=e;return(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"text-sm text-gray-700 mb-1",children:"Режим"}),(0,n.jsx)("select",{className:"select",value:r,onChange:e=>s(e.target.value),children:Object.entries(t).map(e=>{let[t,r]=e;return(0,n.jsxs)("option",{value:t,children:[r.name," ","ready"!==r.status?"(soon)":""]},t)})})]})}function l(e){let{sets:t,value:r,onChange:s}=e;return(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"text-sm text-gray-700 mb-1",children:"Набір слів"}),(0,n.jsx)("select",{className:"select",value:r,onChange:e=>s(e.target.value),children:t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]})}var d=r(2464);async function c(e,t){if(!e)try{return JSON.parse(localStorage.getItem("guest:progress:".concat(t))||"{}")}catch(e){return{}}let r=(0,d.e)(),{data:n,error:s}=await r.from("user_progress").select("word_id, short_memory").eq("uid",e).eq("set_id",t);if(s)return console.error("getSetProgress error",s),{};let i={};return(n||[]).forEach(e=>{var t;i[e.word_id]={shortMemory:null!==(t=e.short_memory)&&void 0!==t?t:0}}),i}async function o(e,t,r,n){var s;if(!e){let e="guest:progress:".concat(t),s=(()=>{try{return JSON.parse(localStorage.getItem(e)||"{}")}catch(e){return{}}})();s[r]={...s[r]||{},...n};try{localStorage.setItem(e,JSON.stringify(s))}catch(e){}return}let i=(0,d.e)(),{error:a}=await i.from("user_progress").upsert({uid:e,set_id:t,word_id:r,short_memory:null!==(s=n.shortMemory)&&void 0!==s?s:0},{onConflict:"uid,word_id"});a&&console.error("saveWordProgress error",a)}async function u(e,t){var r,n;if(!e)try{return JSON.parse(localStorage.getItem("guest:stats:".concat(t))||"{}")}catch(e){return{attempts:0,correct:0}}let s=(0,d.e)(),{data:i,error:a}=await s.from("user_set_stats").select("attempts, correct").eq("uid",e).eq("set_id",t).maybeSingle();return a||!i?{attempts:0,correct:0}:{attempts:null!==(r=i.attempts)&&void 0!==r?r:0,correct:null!==(n=i.correct)&&void 0!==n?n:0}}async function m(e,t,r){if(!e){try{localStorage.setItem("guest:stats:".concat(t),JSON.stringify(r))}catch(e){}return}let n=(0,d.e)(),{error:s}=await n.from("user_set_stats").upsert({uid:e,set_id:t,attempts:r.attempts,correct:r.correct},{onConflict:"uid,set_id"});s&&console.error("saveSetStats error",s)}var f=r(5691);function h(e){let{value:t}=e;return(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[(0,n.jsx)("span",{children:"Прогрес"}),(0,n.jsxs)("span",{children:[t,"%"]})]}),(0,n.jsx)("div",{className:"progress",children:(0,n.jsx)("div",{className:"progress-bar",style:{width:"".concat(t,"%")}})})]})}var x=r(8776);let g={education:{name:"Education",component:function(e){var t;let{setDef:r}=e,[i,a]=(0,s.useState)(null),[l,x]=(0,s.useState)(()=>r.words.map(e=>({...e,shortMemory:0}))),[g,v]=(0,s.useState)(null),[p,y]=(0,s.useState)(""),[w,j]=(0,s.useState)(0),[N,b]=(0,s.useState)(0),[S,M]=(0,s.useState)([]),[_,C]=(0,s.useState)([]),[I,J]=(0,s.useState)([]),[k,O]=(0,s.useState)(0),q=(0,s.useRef)(performance.now());(0,s.useEffect)(()=>{(0,d.e)().auth.getUser().then(e=>{var t,r;let{data:n}=e;return a(null!==(r=null===(t=n.user)||void 0===t?void 0:t.id)&&void 0!==r?r:null)})},[]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{var t,n;let[s,a]=await Promise.all([c(i,r.id),u(i,r.id)]),l=r.words.map(e=>{var t,r;return{...e,shortMemory:null!==(r=null===(t=s[e.id])||void 0===t?void 0:t.shortMemory)&&void 0!==r?r:0}});if(!e)return;x(l),j(null!==(t=a.attempts)&&void 0!==t?t:0),b(null!==(n=a.correct)&&void 0!==n?n:0);let d=l.filter(e=>!(0,f.tm)(e)&&!S.includes(e.id)&&!I.includes(e.id));0===d.length&&(d=l.filter(e=>!(0,f.tm)(e)&&!I.includes(e.id))),0===d.length&&(d=l.filter(e=>!(0,f.tm)(e))),0===d.length&&_.length>0&&(d=l.filter(e=>!(0,f.tm)(e))),0===d.length&&(d=l.filter(e=>!S.includes(e.id)&&!I.includes(e.id))),v(d.length?(0,f.CT)(d):null),q.current=performance.now()})(),()=>{e=!1}},[i,r.id]);let A=(0,s.useMemo)(()=>g?Array.isArray(g.answer)?g.answer:[g.answer]:[],[g]);async function E(e){let t=l.map(t=>{var r;if(!g||t.id!==g.id)return t;let n=e?(null!==(r=t.shortMemory)&&void 0!==r?r:0)+1:0;return{...t,shortMemory:n}});if(x(t),g){var n,s;await o(i,r.id,g.id,{shortMemory:null!==(s=null===(n=t.find(e=>e.id===g.id))||void 0===n?void 0:n.shortMemory)&&void 0!==s?s:0})}let a=g?[...S,g.id].slice(-5):S;M(a),C(e=>{let t=e.map(e=>({...e,remaining:e.remaining-1})).filter(e=>e.remaining>0),r=t.map(e=>e.id);return J(e=>e.filter(e=>r.includes(e))),t});let d=t.filter(e=>!(0,f.tm)(e)&&!a.includes(e.id)&&!I.includes(e.id)).length,c=k%10==0||d<3||100===(0,f.J8)(t),u=[];if(c){let e=t.filter(e=>(0,f.tm)(e)&&!a.includes(e.id)&&!I.includes(e.id));if(e.length>0){let t=(0,f.CT)(e);t&&(u=[t])}if(0===u.length&&100===(0,f.J8)(t)){let e=t.filter(e=>!a.includes(e.id)&&!I.includes(e.id));if(e.length>0){let t=(0,f.CT)(e);t&&(u=[t])}}}0===u.length&&(0===(u=t.filter(e=>!(0,f.tm)(e)&&!a.includes(e.id)&&!I.includes(e.id))).length&&(u=t.filter(e=>!(0,f.tm)(e)&&!I.includes(e.id))),0===u.length&&(u=t.filter(e=>!(0,f.tm)(e))),0===u.length&&_.length>0&&(u=t.filter(e=>!(0,f.tm)(e)))),v(u.length?u[0]:null)}function z(){if(!g)return;let e=p.trim().toLowerCase(),t=A.some(t=>t.trim().toLowerCase()===e);t||(C(e=>{let t=e.findIndex(e=>e.id===g.id);if(!(t>=0))return[...e,{id:g.id,hint:g.hint,answer:A.join(", "),remaining:5}];{let r=[...e];return r[t]={...r[t],remaining:Math.max(r[t].remaining,5)},r}}),J(e=>[...e,g.id])),j(e=>{let n=e+1;return m(i,r.id,{attempts:n,correct:t?N+1:N}),n}),b(e=>{let n=e+(t?1:0);return m(i,r.id,{attempts:w+1,correct:n}),n}),y(""),O(e=>e+1),E(t),q.current=performance.now()}let Z=(0,f.J8)(l);return(0,n.jsxs)("div",{className:"grid gap-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,n.jsxs)("div",{className:"badge",children:["Attempts: ",w]}),(0,n.jsxs)("div",{className:"badge",children:["Correct: ",N]}),(0,n.jsx)("div",{className:"ml-auto w-full md:w-64",children:(0,n.jsx)(h,{value:Z})})]}),(0,n.jsx)("div",{className:"card p-6",children:g?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Підказка"}),(0,f.tm)(g)&&(0,n.jsx)("div",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Повторення"}),100===(0,f.J8)(l)&&(0,n.jsx)("div",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"Всі вивчені!"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"text-2xl md:text-3xl font-semibold",children:g.hint}),(0,n.jsxs)("div",{className:"text-sm bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:[null!==(t=g.shortMemory)&&void 0!==t?t:0,"/15"]})]}),(0,n.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,n.jsx)("input",{className:"input",placeholder:"Введіть відповідь...",value:p,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&z()},autoFocus:!0}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:z,children:"Перевірити"})]})]}):(0,n.jsxs)("div",{className:"text-gray-700",children:["Усі слова в наборі позначені як ",(0,n.jsx)("b",{children:"вивчені"})," (shortMemory > 15). Тепер можна повторювати всі слова!"]})}),_.length>0&&(0,n.jsxs)("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-4 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,n.jsx)("div",{className:"text-sm font-semibold text-red-800",children:"Неправильні відповіді"}),(0,n.jsxs)("div",{className:"ml-auto text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:[_.length," слів"]})]}),(0,n.jsx)("div",{className:"grid gap-2",children:_.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between bg-white/60 rounded-md p-2 border border-red-100",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-800",children:[(0,n.jsx)("span",{className:"font-medium text-red-700",children:e.hint}),(0,n.jsx)("span",{className:"text-gray-500 mx-1",children:"→"}),(0,n.jsx)("span",{className:"font-semibold text-green-700",children:e.answer})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"залишилося"}),(0,n.jsx)("div",{className:"text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded-full min-w-[20px] text-center",children:e.remaining})]})]},e.id))})]})]})},status:"ready"}};function v(){let[e,t]=(0,s.useState)([]),[r,d]=(0,s.useState)(void 0),[c,o]=(0,s.useState)("education"),u=e.find(e=>e.id===r),m=g[c].component;return(0,s.useEffect)(()=>{(async()=>{let e=await (0,x.oA)();if(e.length){var r;t(e),d(null===(r=e[0])||void 0===r?void 0:r.id)}})()},[]),(0,n.jsxs)(i,{children:[(0,n.jsxs)("header",{className:"container-nice flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[(0,n.jsx)("div",{children:(0,n.jsx)("h1",{className:"text-2xl md:text-3xl font-semibold tracking-tight",children:"Quiz Trainer"})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 w-full md:w-auto",children:[(0,n.jsx)(l,{sets:e,value:r,onChange:d}),(0,n.jsx)(a,{modes:g,value:c,onChange:e=>o(e)}),(0,n.jsx)("a",{className:"btn btn-ghost",href:"/quiz/manage",children:"Керувати наборами"})]})]}),(0,n.jsx)("main",{className:"container-nice mt-6",children:(0,n.jsx)("div",{className:"card p-4 md:p-6",children:u?(0,n.jsx)(m,{setDef:u}):(0,n.jsx)("div",{className:"text-gray-700",children:"Немає вибраного набору. Створіть або оберіть набір."})})})]})}},8776:function(e,t,r){"use strict";r.d(t,{G7:function(){return d},Jx:function(){return u},Or:function(){return m},_z:function(){return a},cZ:function(){return l},kB:function(){return f},oA:function(){return i},rI:function(){return h},wH:function(){return c},x8:function(){return o}});var n=r(2464);function s(e){return{id:e.id,hint:e.hint,answer:Array.isArray(e.answers)?e.answers:"string"==typeof e.answers?[e.answers]:[],shortMemory:0}}async function i(){let e=(0,n.e)(),{data:t,error:r}=await e.from("sets").select("id, name, words:words(id, hint, answers)").order("name",{ascending:!0});return r?[]:(t||[]).map(e=>({id:e.id,name:e.name,words:(e.words||[]).map(s)}))}async function a(){let e=(0,n.e)(),{data:t,error:r}=await e.from("sets").select("id, name").order("name",{ascending:!0});return r?[]:t}async function l(e){let t=(0,n.e)(),{data:r,error:i}=await t.from("sets").select("id, name, words:words(id, hint, answers)").eq("id",e).maybeSingle();return i||!r?null:{id:r.id,name:r.name,words:(r.words||[]).map(s)}}async function d(e,t,r){let s=(0,n.e)();await s.from("words").insert({set_id:e,hint:t,answers:r})}async function c(e,t){if(!t.length)return;let r=(0,n.e)();await r.from("words").insert(t.map(t=>({set_id:e,hint:t.hint,answers:t.answers})))}async function o(e){let t=(0,n.e)();await t.from("words").delete().eq("id",e)}async function u(e){let t=(0,n.e)();await t.from("sets").insert({name:e})}async function m(e,t){let r=(0,n.e)();await r.from("sets").update({name:t}).eq("id",e)}async function f(e){let t=(0,n.e)();await t.from("sets").delete().eq("id",e)}async function h(e,t){let r=(0,n.e)();await r.from("words").update(t).eq("id",e)}},5691:function(e,t,r){"use strict";r.d(t,{$B:function(){return n},CT:function(){return i},J8:function(){return a},tm:function(){return s}});let n=15;function s(e){var t;return(null!==(t=e.shortMemory)&&void 0!==t?t:0)>n}function i(e){var t;if(!e.length)return null;let r=Math.min(...e.map(e=>{var t;return null!==(t=e.shortMemory)&&void 0!==t?t:0})),n=e.filter(e=>{var t;return(null!==(t=e.shortMemory)&&void 0!==t?t:0)===r});return null!==(t=n[Math.floor(Math.random()*n.length)])&&void 0!==t?t:null}function a(e){return e.length?Math.round(e.filter(s).length/e.length*100):0}},2464:function(e,t,r){"use strict";r.d(t,{e:function(){return s}});var n=r(5570);let s=()=>(0,n.createBrowserClient)("https://wlyskuyqdvvzivgrssyd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndseXNrdXlxZHZ2eml2Z3Jzc3lkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxOTQwODcsImV4cCI6MjA3MDc3MDA4N30.PuRk6yZtgrMMdsVYzgWkabvlvtuLwv6PKD47m8aowYA")}},function(e){e.O(0,[570,971,23,744],function(){return e(e.s=5946)}),_N_E=e.O()}]);