(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{482:function(e,t,n){Promise.resolve().then(n.bind(n,5833))},5833:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var s=n(7437),r=n(7138),i=n(2265),a=n(8776),c=n(7440),l=n(6463);function u(){let e=(0,l.useSearchParams)().get("setId"),[t,n]=(0,i.useState)(null),[u,d]=(0,i.useState)(!0),[o,m]=(0,i.useState)(""),[f,h]=(0,i.useState)(!1),[w,x]=(0,i.useState)({}),[y,p]=(0,i.useState)(null);async function g(){if(!e)return;d(!0),n(await (0,a.cZ)(e)),d(!1);let t={},s=await (0,a.cZ)(e);s&&s.words.forEach(e=>{t[e.id]={hint:e.hint,answersText:(Array.isArray(e.answer)?e.answer:[e.answer]).join(", "),dirty:!1,saving:!1}}),x(t)}function v(e){let t=e.split(/\r?\n/),n=[];for(let e of t){let t=function(e){let t=e.trim();if(!t)return null;let[n,s]=t.split("-"),r=(n||"").trim(),i=(s||"").split(",").map(e=>e.trim()).filter(Boolean);return r&&0!==i.length?{hint:r,answers:i}:null}(e);t&&n.push(t)}return n}async function j(n){if(n.preventDefault(),!e)return;let s=v(o);if(!s.length)return;let r=(null==t?void 0:t.words.map(e=>e.hint.toLowerCase()))||[],i=s.map(e=>e.hint.toLowerCase()).filter(e=>r.includes(e));if(i.length>0){p("Дублікати підказок: ".concat(i.join(", ")));return}p(null),h(!0);try{await (0,a.wH)(e,s),m(""),await g()}finally{h(!1)}}async function b(e){confirm("Видалити слово?")&&(await (0,a.x8)(e),await g())}function N(e,t,n){x(s=>({...s,[e]:{...s[e]||{hint:"",answersText:"",dirty:!1,saving:!1},[t]:n,dirty:!0}}))}(0,i.useEffect)(()=>{e?g():d(!1)},[e]);let I=Object.values(w).some(e=>e.dirty);async function C(){let e=Object.entries(w).filter(e=>{let[,t]=e;return t.dirty});if(!e.length)return;let t=e.map(e=>{let[t,n]=e;return{id:t,hint:n.hint.trim(),answers:n.answersText.split(",").map(e=>e.trim()).filter(Boolean)}}).filter(e=>e.hint&&e.answers.length);x(t=>e.reduce((e,n)=>{let[s]=n;return{...e,[s]:{...t[s],saving:!0}}},t));try{await Promise.all(t.map(e=>(0,a.rI)(e.id,{hint:e.hint,answers:e.answers}))),await g()}finally{x(e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,n]=e;return[t,{...n,saving:!1,dirty:!1}]})))}}return e?(0,s.jsxs)("div",{className:"container-nice py-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Слова набору"}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)(r.default,{className:"btn btn-ghost",href:(0,c.w)("/quiz/manage"),children:"← До наборів"}),(0,s.jsx)("button",{className:"btn btn-primary",disabled:!I,onClick:C,children:"Зберегти зміни"})]})]}),(0,s.jsx)("div",{className:"card p-4 md:p-6",children:u?(0,s.jsx)("div",{className:"text-gray-600",children:"Завантаження…"}):t?(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("div",{className:"text-gray-700 font-medium mb-2",children:t.name}),(0,s.jsxs)("form",{onSubmit:j,className:"grid gap-2 mb-4",children:[y&&(0,s.jsx)("div",{className:"text-red-600 text-sm",children:y}),(0,s.jsx)("textarea",{className:"input min-h-[120px]",placeholder:"Кілька рядків у форматі:\ncat - кіт, котик\nto run - бігти, бігати",value:o,onChange:e=>m(e.target.value)}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{className:"btn btn-primary",disabled:f||0===v(o).length,children:f?"Додавання…":"Додати всі"})})]}),(0,s.jsxs)("div",{className:"hidden md:grid md:grid-cols-[1fr_1fr_auto] md:gap-2 text-xs text-gray-500 px-1",children:[(0,s.jsx)("div",{children:"Підказка (hint)"}),(0,s.jsx)("div",{children:"Відповіді (через кому)"}),(0,s.jsx)("div",{})]}),t.words.map(e=>{let t=w[e.id]||{hint:e.hint,answersText:(Array.isArray(e.answer)?e.answer:[e.answer]).join(", "),dirty:!1,saving:!1};return(0,s.jsxs)("div",{className:"grid md:grid-cols-[1fr_1fr_auto] gap-2 items-center text-sm",children:[(0,s.jsx)("input",{className:"input",value:t.hint,onChange:t=>N(e.id,"hint",t.target.value)}),(0,s.jsx)("input",{className:"input",value:t.answersText,onChange:t=>N(e.id,"answersText",t.target.value)}),(0,s.jsx)("div",{className:"flex gap-2 justify-end",children:(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>b(e.id),children:"Видалити"})})]},e.id)}),!t.words.length&&(0,s.jsx)("div",{className:"text-gray-600",children:"Поки немає слів."})]}):(0,s.jsx)("div",{className:"text-gray-600",children:"Набір не знайдено."})})]}):(0,s.jsx)("div",{className:"container-nice py-6",children:(0,s.jsxs)("div",{className:"card p-6 text-center",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold mb-4",children:"Виберіть набір"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Для редагування слів потрібно вибрати набір."}),(0,s.jsx)(r.default,{className:"btn btn-primary",href:(0,c.w)("/quiz/manage"),children:"До наборів"})]})})}},8776:function(e,t,n){"use strict";n.d(t,{G7:function(){return l},Jx:function(){return o},Or:function(){return m},_z:function(){return a},cZ:function(){return c},kB:function(){return f},oA:function(){return i},rI:function(){return h},wH:function(){return u},x8:function(){return d}});var s=n(2464);function r(e){return{id:e.id,hint:e.hint,answer:Array.isArray(e.answers)?e.answers:"string"==typeof e.answers?[e.answers]:[],shortMemory:0}}async function i(){let e=(0,s.e)(),{data:t,error:n}=await e.from("sets").select("id, name, words:words(id, hint, answers)").order("name",{ascending:!0});return n?[]:(t||[]).map(e=>({id:e.id,name:e.name,words:(e.words||[]).map(r)}))}async function a(){let e=(0,s.e)(),{data:t,error:n}=await e.from("sets").select("id, name").order("name",{ascending:!0});return n?[]:t}async function c(e){let t=(0,s.e)(),{data:n,error:i}=await t.from("sets").select("id, name, words:words(id, hint, answers)").eq("id",e).maybeSingle();return i||!n?null:{id:n.id,name:n.name,words:(n.words||[]).map(r)}}async function l(e,t,n){let r=(0,s.e)();await r.from("words").insert({set_id:e,hint:t,answers:n})}async function u(e,t){if(!t.length)return;let n=(0,s.e)();await n.from("words").insert(t.map(t=>({set_id:e,hint:t.hint,answers:t.answers})))}async function d(e){let t=(0,s.e)();await t.from("words").delete().eq("id",e)}async function o(e){let t=(0,s.e)();await t.from("sets").insert({name:e})}async function m(e,t){let n=(0,s.e)();await n.from("sets").update({name:t}).eq("id",e)}async function f(e){let t=(0,s.e)();await t.from("sets").delete().eq("id",e)}async function h(e,t){let n=(0,s.e)();await n.from("words").update(t).eq("id",e)}},2464:function(e,t,n){"use strict";n.d(t,{e:function(){return r}});var s=n(5570);let r=()=>(0,s.createBrowserClient)("https://wlyskuyqdvvzivgrssyd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndseXNrdXlxZHZ2eml2Z3Jzc3lkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxOTQwODcsImV4cCI6MjA3MDc3MDA4N30.PuRk6yZtgrMMdsVYzgWkabvlvtuLwv6PKD47m8aowYA")},7440:function(e,t,n){"use strict";function s(e){return e}n.d(t,{w:function(){return s}})},6463:function(e,t,n){"use strict";var s=n(1169);n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}}),n.o(s,"useSearchParams")&&n.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[570,138,971,23,744],function(){return e(e.s=482)}),_N_E=e.O()}]);